= Finding relevant reviews

== Finding relevant reviews

In this section we'll learn how to use the Personalized PageRank algorithm to return relevant businesses in search results.

[source, cypher]
----
:params userId => "7C4B2Skmh4X9f8xJDo9O4w";

match (u:User {id: $userId})-[:FRIENDS]-(other)
WITH collect(other) AS others
UNWIND others as other
MATCH (other)-[:WROTE]->()-[:REVIEWS]->(business)
WITH collect(distinct business) AS businesses, others

CALL algo.pageRank.stream(
  'MATCH (u:User) RETURN id(u) AS id UNION MATCH (b:Business) RETURN id(b) AS id',
  'MATCH (u:User)-[:WROTE]->(review)-[:REVIEWS]->(business)
   RETURN id(u) AS source, id(business) AS target, review.stars AS weight',
  {iterations:20, dampingFactor:0.85, weightProperty: "weight", sourceNodes: others + businesses}
)
YIELD nodeId, score
WITH algo.getNodeById(nodeId) AS node, score WHERE node:Business

RETURN node.name AS page,score
ORDER BY score DESC;
----
